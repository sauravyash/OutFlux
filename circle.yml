machine:
  node:
    version: 8.4.0
dependencies:
  override:
    - npm set progress=false
    - npm install
    - npm install rimraf -g
    - npm install electron-packager -g
    - sudo apt-get install build-essential checkinstall
test:
  override:
    - electron-packager . OutFlux --platform=linux --arch=x64
    - tar -czvf test-outflux.tar.gz OutFlux-linux-x64
    - gpt-build test-outflux.tar.gz -verbose
    - node test

deployment:
  release:
    tag: /v[0-9]+(\.[0-9]+)*/
    commands:
      - sudo apt-get install ruby ruby-dev gcc make icnsutils graphicsmagick xz-utils
      - gem install fpm
      - npm run dist
      - node ./build/release-to-github.js
